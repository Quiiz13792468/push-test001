<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>메인 수신 페이지 (A)</title>
    <script src="https://js.pusher.com/8.0/pusher.min.js"></script>
</head>
<body>
    <h1>알람 수신 대기 중...</h1>
    <p>Pusher Debug Console에서 보낸 메시지가 여기에 뜹니다.</p>
    <button onclick="enableNoti()">1. 알람 권한 허용하기</button>

    <script>
        // 1. 알람 권한 요청
        function enableNoti() {
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    alert('알람 권한이 허용되었습니다!');
                }
            });
        }

        // 2. Pusher 설정 (사용자님의 키 그대로 사용)
        const pusher = new Pusher('0141d98cb9c6561678d4', {
            cluster: 'ap3'
        });

        // 3. 'alarm-channel' 구독
        const channel = pusher.subscribe('alarm-channel');

        // 4. 'send-event'라는 이름의 신호를 기다림
        channel.bind('send-event', function(data) {
            console.log("신호 받음:", data); // 브라우저 개발자 도구(F12)에서 확인 가능
            
            if (Notification.permission === 'granted') {
                new Notification("관리자 메시지", {
                    body: data.message, // 보낸 내용
                    icon: "https://via.placeholder.com/128"
                });
            } else {
                alert("메시지 도착: " + data.message + "\n(알람 권한을 먼저 허용해주세요)");
            }
        });
    </script>
</body>
</html>